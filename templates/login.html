{% extends "base_layout.html" %}

{% block title %}Login - Vision Explainer{% endblock %}

{% set active_tab = active_tab|default('login') %}

{% block content %}
<div class="auth-container">
    <div class="auth-card">
        <div class="auth-header">
            <h1 class="auth-title">Welcome</h1>
            <p class="auth-subtitle">Please select a method to continue</p>
        </div>
        
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <div class="flash-message flash-{{ category }}">
                            {{ message }}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
        
        <div class="auth-tabs">
            <button class="tab-btn {% if active_tab == 'login' %}active{% endif %}" onclick="showTab('login')">Login</button>
            <button class="tab-btn {% if active_tab == 'signup' %}active{% endif %}" onclick="showTab('signup')">Sign Up</button>
            <button class="tab-btn {% if active_tab == 'guest' %}active{% endif %}" onclick="showTab('guest')">Guest</button>
        </div>

        <!-- LOGIN SECTION -->
        <div id="login-section" class="auth-section" style="display: {% if active_tab == 'login' %}block{% else %}none{% endif %};">
            <form method="POST" action="{{ url_for('auth.login') }}" class="auth-form" id="loginForm">
                <div class="form-group">
                    <label for="email" class="form-label">Email Address</label>
                    <input type="email" id="email" name="email" class="form-input" placeholder="your.email@example.com" required autocomplete="email">
                </div>
                <div class="form-group">
                    <label for="password" class="form-label">Password</label>
                    <input type="password" id="password" name="password" class="form-input" placeholder="Enter your password" required autocomplete="current-password">
                </div>
                <button type="submit" class="btn btn-primary btn-block">Login</button>
            </form>
        </div>

        <!-- SIGNUP SECTION -->
        <div id="signup-section" class="auth-section" style="display: {% if active_tab == 'signup' %}block{% else %}none{% endif %};">
            <form method="POST" action="{{ url_for('auth.register') }}" class="auth-form" id="registerForm">
                <div class="form-group">
                    <label for="reg_name" class="form-label">Full Name</label>
                    <input type="text" id="reg_name" name="name" class="form-input" placeholder="John Doe" autocomplete="name">
                </div>
                <div class="form-group">
                    <label for="reg_email" class="form-label">Email Address</label>
                    <input type="email" id="reg_email" name="email" class="form-input" placeholder="your.email@example.com" required autocomplete="email">
                </div>
                <div class="form-group">
                    <label for="reg_password" class="form-label">Password</label>
                    <input type="password" id="reg_password" name="password" class="form-input" placeholder="At least 6 characters" required autocomplete="new-password" minlength="6">
                </div>
                <div class="form-group">
                    <label for="reg_confirm_password" class="form-label">Confirm Password</label>
                    <input type="password" id="reg_confirm_password" name="confirm_password" class="form-input" placeholder="Re-enter your password" required autocomplete="new-password" minlength="6">
                </div>
                <button type="submit" class="btn btn-success btn-block">Create Account</button>
            </form>
        </div>

        <!-- GUEST SECTION -->
        <div id="guest-section" class="auth-section" style="display: {% if active_tab == 'guest' %}block{% else %}none{% endif %};">
            <div style="text-align: center; padding: 2rem 0;">
                <p style="margin-bottom: 1.5rem; color: var(--text-secondary);">Access the dashboard with limited features as a guest user.</p>
                <a href="{{ url_for('auth.guest_login') }}" class="btn btn-secondary btn-block">Continue as Guest</a>
            </div>
        </div>
        
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
function showTab(tabName) {
    document.getElementById('login-section').style.display = 'none';
    document.getElementById('signup-section').style.display = 'none';
    document.getElementById('guest-section').style.display = 'none';
    
    const tabs = document.querySelectorAll('.tab-btn');
    tabs.forEach(tab => tab.classList.remove('active'));
    
    document.getElementById(tabName + '-section').style.display = 'block';
    
    if(tabName === 'login') tabs[0].classList.add('active');
    if(tabName === 'signup') tabs[1].classList.add('active');
    if(tabName === 'guest') tabs[2].classList.add('active');
}

document.addEventListener('DOMContentLoaded', function() {
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                {% if category == 'error' %}
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: '{{ message }}',
                        background: '#1a1a2e',
                        color: '#ffffff',
                        confirmButtonColor: '#667eea'
                    });
                {% elif category == 'success' %}
                    Swal.fire({
                        icon: 'success',
                        title: 'Success!',
                        text: '{{ message }}',
                        background: '#1a1a2e',
                        color: '#ffffff',
                        confirmButtonColor: '#10b981'
                    });
                {% elif category == 'login_success' %}
                    Swal.fire({
                        icon: 'success',
                        title: 'Success!',
                        text: '{{ message }}',
                        background: '#1a1a2e',
                        color: '#ffffff',
                        confirmButtonColor: '#10b981'
                    }).then(() => {
                        window.location.href = "{{ next_page|default(url_for('main.dashboard')) }}";
                    });
                {% endif %}
            {% endfor %}
        {% endif %}
    {% endwith %}
});
</script>
{% endblock %}
